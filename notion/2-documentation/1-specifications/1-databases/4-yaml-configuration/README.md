**Status:** üéØ Done

---

# Purpose

The YAML Configuration Database tracks generated YAML configuration files with versioning and provider-specific configurations. This database serves as the **single source of truth** for configuration file versions and deployment tracking.

**Important:** This database tracks the **OUTPUT** (generated configuration files), while the Mapping Fields Database tracks the **INPUT** (mapping rules used to generate configurations).

**Key Contents:** Generated YAML files per provider, semantic versioning, generation metadata, relations to mapping fields, deployment status tracking.

---

# Database Structure

## Column Definitions

Columns are listed in the same order as they appear in the CSV export:

| Column Name | Type | Required | Description | Example |
| --- | --- | --- | --- | --- |
| **Config Name** | Title | ‚úÖ Yes | Unique configuration identifier (primary key) | `navixy-v1.0.0` |
| **Change History** | Text | ‚ùå No | Description of changes in this version | `Location section only from Fleeti Fields (db)` |
| **Deployed To** | Text | ‚ùå No | Environment where config is deployed | `production`, `staging`, `development`, `not deployed` |
| **Deployment Date** | Date | ‚ùå No | When configuration was deployed | `2025-01-16 15:00:00` |
| **Generated By** | Person | ‚úÖ Yes | Who generated the configuration | (Notion person) |
| **Generation Date** | Date | ‚úÖ Yes | When configuration was generated | `December 17, 2025` |
| **Last Modified** | Date | ‚úÖ Yes | Last modification date | `December 22, 2025 3:17 PM` |
| **Notes** | Text | ‚ùå No | Additional context | `Initial draft to iterate on.` |
| **Provider** | Select | ‚úÖ Yes | Provider name | `navixy`, `oem-trackunit`, `oem-volvo` |
| **Status** | Select | ‚úÖ Yes | Configuration status | `active`, `deprecated`, `pending` |
| **Version** | Text | ‚úÖ Yes | Semantic version | `1.0.0`, `1.0.1`, `1.0.6` |
| **YAML Content** | Text/File | ‚úÖ Yes | Generated YAML configuration content | `navixy-mapping.yaml` |
| **üíΩ Mapping Fields (db)** | Relation | ‚úÖ Yes | Links to Mapping Fields used in generation | (Relation) |

## Primary Key

**Config Name** serves as the primary key. Should be unique and follow format: `{provider}-v{version}` (e.g., `navixy-v1.0.0`, `oem-trackunit-v2.1.0`).

**Important:** The combination of **Provider** + **Version** must be unique. Each provider can have multiple versions, but each version must be unique per provider.

## Validation Rules

- **Config Name**: Must be unique and follow format `{provider}-v{version}`
- **Provider + Version**: Must be unique combination
- **Version**: Should follow semantic versioning (e.g., `1.0.0`, `1.0.1`, `1.0.6`)
- **YAML Content**: Must be valid YAML syntax (can be filename reference or full content)
- **Status**: Values are `active`, `deprecated`, `pending`

---

# How to Use

- Track generated YAML configuration files with versioning
- Manage configuration deployment and rollback
- Identify which mapping rules are included in each configuration version
- Audit configuration changes and deployment history

**Workflow:** Generate configuration from Mapping Fields Database ‚Üí Review and validate ‚Üí Deploy to environment ‚Üí Track changes and lifecycle

---

# YAML Generation Specification

YAML configurations are generated from Mapping Fields CSV exports using Python scripts. The process: export Mapping Fields database ‚Üí script reads CSV ‚Üí extracts Computation Structure JSON ‚Üí applies 8 optimization rules ‚Üí orders by dependencies ‚Üí generates YAML with comments ‚Üí outputs to `output/` directory.

## Generation Scripts

**`scripts/generate_yaml_from_csv.py`**: Generates YAML from Mapping Fields CSV

[Generate YAML From CSV](https://www.notion.so/Generate-YAML-From-CSV-2e33e766c90180ac9451f292dba1efbd?pvs=21)

- Input: Most recent CSV from `3-mapping-fields/export/` (auto-detected)
- Output: YAML file in `output/` directory (filename: `{provider}-mapping-{date}.yaml`)
- Process: Reads Computation Structure JSON, applies optimization rules from `yaml-mapping-reference.yaml`, orders mappings by `parameters.fleeti` dependencies, injects comments (Field Path, Computation Approach)
- Filters: Only processes mappings with status `active` or `planned`

**`scripts/validate_yaml.py`**: Validates generated YAML

[Validate YAML](https://www.notion.so/Validate-YAML-2e33e766c901803c982cccd277f4bcbb?pvs=21)

- Validates YAML syntax and structure
- Cross-checks CSV/YAML key sets match
- Validates Fleeti Field Paths format
- Checks dependency order (fields referenced in `parameters.fleeti` must appear before dependents)

**Note:** Scripts assume local project structure (paths relative to script location). Adapt paths for your environment.

## Key Concepts

**Field Name vs Field Path**: YAML uses **Field Names** (stable identifiers like `location_latitude`) as keys, not **Field Paths** (can change like `location.latitude`). Backend resolves Field Names to Field Paths at runtime.

**Mapping Types**: `direct`, `prioritized`, `calculated`, `transformed`, `io_mapped`, `mix` - each generates different YAML structure.

**Parameter Types** (for calculated fields):

- `provider:` - References provider telemetry fields
- `fleeti:` - References other Fleeti fields (dependencies)
- `static:` - Constant values (bit positions, thresholds, etc.)

## YAML Mapping Reference

[YAML Configuration Specification](https://www.notion.so/YAML-Configuration-Specification-2e33e766c901804f982bc8d0357430db?pvs=21)

The **`yaml-mapping-reference.yaml`** file is the authoritative specification for YAML structure. It contains:

- **8 Optimization Rules**: Rules for minimizing redundancy while maintaining clarity
- **Parameter Types**: Complete documentation of provider, fleeti, and static parameters
- **Mapping Type Examples**: Detailed examples for all mapping types (direct, prioritized, calculated, transformed, io_mapped)
- **Backend Processing Details**: How each mapping type is processed by the backend

**Location:** `yaml-mapping-reference.yaml` in this directory

**Usage:** Refer to this file when:

- Understanding YAML structure requirements
- Writing or modifying YAML generation scripts
- Debugging YAML configuration issues
- Implementing backend YAML parsing logic

---

# Database

[YAML Configurations (db)](https://www.notion.so/2cc3e766c90180199843f5b0ce72e2ed?pvs=21)