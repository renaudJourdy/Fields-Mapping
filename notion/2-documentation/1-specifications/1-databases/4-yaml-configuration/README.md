**Status:** üéØ Done

# Purpose

The YAML Configuration Database tracks generated YAML configuration files with versioning and provider-specific configurations. This database serves as the **single source of truth** for configuration file versions and deployment tracking.

**Important:** This database tracks the **OUTPUT** (generated configuration files), while the Mapping Fields Database tracks the **INPUT** (mapping rules used to generate configurations).

---

# What This Database Contains

- **Generated YAML configuration files**: Complete YAML configuration files per provider
- **Version tracking**: Semantic versioning per provider (e.g., `1.0.0`, `1.1.0`)
- **Generation metadata**: When configurations were generated, by whom, and their status
- **Relations to mapping fields**: Links to all mapping rules included in each configuration version
- **Deployment tracking**: Status of configurations (active, deprecated, draft, pending)

---

# Database Structure

## Column Definitions

| Column Name | Type | Required | Description | Example | Why It's Important |
| --- | --- | --- | --- | --- | --- |
| **Config Name** | Title | ‚úÖ Yes | Unique configuration identifier (primary key) | `navixy-v1.0.0` | Primary key - uniquely identifies each configuration version. Format: `{provider}-v{version}`. Enables quick identification and lookup. |
| **Provider** | Select | ‚úÖ Yes | Provider name | `navixy`, `oem-trackunit`, `oem-volvo` | Identifies which provider this configuration applies to. Required for multi-provider support. Enables filtering by provider. |
| **Version** | Text | ‚úÖ Yes | Semantic version | `1.0.0`, `1.1.0`, `2.0.0` | Tracks configuration version using semantic versioning. Critical for version management and rollback. Should follow semver format. |
| **YAML Content** | Text/File | ‚úÖ Yes | Generated YAML configuration content | (YAML file content) | Complete YAML configuration file content. Can be stored as text or file reference. Critical for configuration deployment and reference. |
| **Generation Date** | Date | ‚úÖ Yes | When configuration was generated | `2025-01-16 14:30:00` | Timestamp of configuration generation. Enables chronological tracking and "recently generated" views. |
| **Generated By** | Person | ‚úÖ Yes | Who generated the configuration | (Notion person) | Accountability and audit trail. Enables questions and collaboration. Critical for compliance. |
| **Status** | Select | ‚úÖ Yes | Configuration status | `active`, `deprecated`, `draft`, `pending` | Tracks configuration lifecycle. `active` = currently deployed, `deprecated` = replaced by newer version, `draft` = work in progress, `pending` = awaiting deployment. Critical for deployment management. |
| **Mapping Fields** | Relation | ‚úÖ Yes | Links to Mapping Fields used in generation | (Relation) | Links to all mapping rules included in this configuration version. Enables impact analysis when mappings change. Critical for tracking which mappings are in which config version. |
| **Change History** | Relation | ‚ùå No | Links to Change History entries | (Relation) | Complete audit trail of changes related to this configuration. Important for compliance and troubleshooting. |
| **Deployment Date** | Date | ‚ùå No | When configuration was deployed | `2025-01-16 15:00:00` | Tracks actual deployment timestamp. Useful for tracking deployment cycles and rollback planning. |
| **Deployed To** | Text | ‚ùå No | Environment or system where config is deployed | `production`, `staging`, `development` | Tracks deployment environments. Enables multi-environment configuration management. |
| **Notes** | Text | ‚ùå No | Additional context | `Includes all P0 and P1 fields for Navixy` | Captures important context, limitations, or special requirements. Helps developers understand configuration scope. |
| **Last Modified** | Date | ‚úÖ Yes | Last modification date | `2025-01-16` | Tracks recent changes. Enables change notifications and "recently modified" views. |

## Primary Key

**Config Name** serves as the primary key. Should be unique and follow format: `{provider}-v{version}` (e.g., `navixy-v1.0.0`, `oem-trackunit-v2.1.0`).

**Important:** The combination of **Provider** + **Version** must be unique. Each provider can have multiple versions, but each version must be unique per provider.

## Validation Rules

- **Config Name**: Must be unique and follow format `{provider}-v{version}`
- **Provider**: Must be one of the valid provider names
- **Version**: Should follow semantic versioning (e.g., `1.0.0`, `1.1.0`, `2.0.0`)
- **YAML Content**: Must be valid YAML syntax
- **Status**: Cannot be `active` if YAML Content is empty or invalid
- **Mapping Fields**: Should include all active mappings for the provider (at time of generation)
- **Generation Date**: Must be a valid timestamp

## Indexes & Performance

- **Index on Provider + Version**: Fast lookups by provider and version
- **Index on Status**: Efficient filtering of active configurations
- **Index on Generation Date**: Quick chronological sorting
- **Index on Provider**: Fast filtering by provider

---

# How to Use

This database is used to:

- Track generated YAML configuration files with versioning
- Manage configuration deployment and rollback
- Identify which mapping rules are included in each configuration version
- Audit configuration changes and deployment history
- Support multi-environment configuration management

## Workflow

1. **Generate Configuration**: Create new configuration entry from Mapping Fields Database
    - Select provider and assign version number
    - Generate YAML content using YAML Generation Specification
    - Link to all Mapping Fields used in generation
2. **Review and Validate**: Review generated configuration
    - Validate YAML syntax
    - Verify all required mappings are included
    - Set status to `draft` or `pending`
3. **Deploy Configuration**: Deploy to target environment
    - Update status to `active`
    - Record deployment date and environment
    - Mark previous version as `deprecated` if replacing it
4. **Track Changes**: Monitor configuration lifecycle
    - Link to Change History entries
    - Track modifications and deployments
    - Maintain audit trail

---

# YAML Generation Specification

YAML configurations are generated from the Mapping Fields Database following a detailed specification. The generation process involves:

## Key Concepts

**Field Name vs Field Path**: YAML configurations use **Field Names** (stable identifiers like `location_latitude`) instead of **Field Paths** (can change like `location.latitude`). This ensures configurations remain valid even when telemetry object structure changes. The backend resolves Field Names to Field Paths at runtime using a lookup table.

**Database Joins**: Generation requires joining with:

- **Fleeti Fields Database**: For field metadata (Field Name, Field Path, Unit, Data Type)
- **Provider Fields Database**: For provider field metadata (Field Path, Unit, Data Type, Availability)

**Mapping Type Processing**: Different mapping types generate different YAML structures:

- **Direct**: Simple 1:1 field mapping
- **Prioritized**: Multiple provider fields with priority order
- **Calculated**: Function references or formulas with dependencies
- **Transformed**: Transformations combining telemetry with static data
- **I/O Mapped**: Raw I/O to semantic field mapping
- **Asset-Integrated**: Integration with external services

**Function Registry Pattern**: Calculated fields use a function registry pattern that enables:

- Direct function calls from backend registry
- Structured parameter mapping to Fleeti field names
- Validation of function existence and parameters
- Stable configuration using Field Names

---

# Related Documentation

- **üîÄ Mapping Fields Database**: Source of mapping rules used to generate configurations
- **üì• Provider Fields Database**: Source provider fields referenced in configurations
- **üéØ Fleeti Fields Database**: Target Fleeti fields referenced in configurations
- **üìù Change History Database**: Audit trail of configuration changes

---

# Database

[YAML Configurations (db)](https://www.notion.so/2cc3e766c90180199843f5b0ce72e2ed?pvs=21)