version: "1.0.0"
provider: "navixy"
mappings:
  location.latitude:
    type: "direct"
    source: "lat"
    unit: "degrees"
    data_type: "number"
  
  location.longitude:
    type: "direct"
    source: "lng"
    unit: "degrees"
    data_type: "number"
  
  location.altitude:
    type: "direct"
    source: "alt"
    unit: "meters"
    data_type: "number"
  
  location.heading:
    type: "direct"
    source: "heading"
    unit: "degrees"
    data_type: "number"
  
  location.precision.fix_quality:
    type: "direct"
    source: "params.avl_io_69"
    unit: "none"
    data_type: "number"
  
  location.precision.satellites:
    type: "direct"
    source: "satellites"
    unit: "none"
    data_type: "number"
  
  location.precision.hdop:
    type: "prioritized"
    sources:
      - priority: 1
        field: "hdop"
        path: "hdop"
      - priority: 2
        field: "avl_io_182"
        path: "params.avl_io_182"
    unit: "none"
    data_type: "number"
    error_handling: "use_fallback"
  
  location.precision.pdop:
    type: "prioritized"
    sources:
      - priority: 1
        field: "pdop"
        path: "pdop"
      - priority: 2
        field: "avl_io_181"
        path: "params.avl_io_181"
    unit: "none"
    data_type: "number"
    error_handling: "use_fallback"
  
  location.cardinal_direction:
    type: "calculated"
    calculation_type: "code_based"
    formula: |
      Derived from location.heading
      dirs = ["N","NE","E","SE","S","SW","W","NW"];
      cardinal = dirs[Math.floor((heading + 22.5) % 360 / 45)];
    dependencies:
      - "location.heading"
    data_type: "string"
  
  location.geocoded_address:
    type: "calculated"
    calculation_type: "code_based"
    formula: "Use external API (Google) to convert latitude and longitude into geocoded address."
    dependencies:
      - "location.latitude"
      - "location.longitude"
    data_type: "string"
  
  location.last_changed_at:
    type: "calculated"
    calculation_type: "code_based"
    formula: |
      Backend compares current position with previous.
      if (lat !== prev.lat || lon !== prev.lon) {
      location_last_changed_at= now();
      }
    dependencies:
      - "location.latitude"
      - "location.longitude"
    data_type: "datetime"

