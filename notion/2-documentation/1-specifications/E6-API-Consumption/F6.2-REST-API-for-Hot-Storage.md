**Epic:** E6 – API & Consumption  
**Depends on:** E4 (hot storage)  
**Related Features:** F6.3 (REST API for Warm Storage), F6.4 (API Authentication)

---

## 1. Description

Expose REST API endpoints for querying core telemetry fields from hot storage. Provides < 100ms access to core fields for real-time use cases.

### 1.1 Purpose

Enable REST API access to core telemetry fields. Provides fast access to location, speed, status, and other core fields needed for real-time applications.

### 1.2 Context

Some clients prefer REST API over WebSocket for real-time data. Hot storage REST API provides fast access to core fields with < 100ms latency.

### 1.3 Value Proposition

Enables REST API access to core fields with low latency. Supports clients that prefer REST over WebSocket.

---

## 2. Business Logic

### 2.1 Rules & Priority

**API Endpoints:**
- `GET /api/v1/telemetry/hot/assets/{assetId}` - Get current core fields for asset
- `GET /api/v1/telemetry/hot/assets` - Get current core fields for multiple assets
- Query parameters: `fields[]`, `assetIds[]`

**Response Format:**
- Core fields only (~25-30 fields)
- Include top_status and statuses[]
- Timestamp and asset metadata

**Performance:**
- < 100ms response latency
- Optimized queries to hot storage

### 2.2 States & Behaviors

**API States:**
- **Available**: API is available and responding
- **Degraded**: API is slow or partially available
- **Unavailable**: API is down

**Behaviors:**
- Query hot storage for core fields
- Return JSON response
- Handle errors gracefully

### 2.3 Edge Cases

- **Asset Not Found**: Return 404
- **Storage Unavailable**: Return 503
- **Invalid Parameters**: Return 400

---

## 3. Technical Specification

### 3.1 Inputs

- **Asset ID**: Asset identifier (path parameter)
- **Query Parameters**: Fields filter, asset IDs filter
- **Authentication**: API token (header)

### 3.2 Processing Logic

1. Authenticate request (F6.4)
2. Validate parameters
3. Query hot storage for core fields
4. Format response
5. Return JSON response

### 3.3 Outputs

- **JSON Response**: Core fields data
- **HTTP Status**: 200 OK, 400 Bad Request, 404 Not Found, 503 Service Unavailable

### 3.4 Data Structures

```json
{
  "asset_id": "uuid",
  "timestamp": 1234567890123,
  "location": { "latitude": 14.6661, "longitude": -17.0712 },
  "motion": { "speed": 45.2 },
  "status": { "top_status": "in_transit", "statuses": [...] }
}
```

---

## 4. Integration & Contracts

### 4.1 API Contracts

**API Contract:** [`../api-contracts/README.md`](../api-contracts/README.md)

Detailed REST API contract specification including endpoints, request/response formats, and error codes.

### 4.3 External Service Integration

**Service:** Hot Storage (Epic 4)  
**Integration Type:** Storage query API  
**Usage:** Query core fields

---

## 5. Cross-Cutting Concerns

### 5.1 Security

**Reference:** [`../../7-security/README.md`](../../7-security/README.md)

API requests must be authenticated. See security documentation.

### 5.3 Error Handling

**Reference:** [`../../5-operations/error-handling.md`](../../5-operations/error-handling.md)

API errors must be handled gracefully. See error handling documentation.

### 5.4 Monitoring & Observability

**Reference:** [`../../5-operations/monitoring-observability.md`](../../5-operations/monitoring-observability.md)

Must emit metrics: `telemetry.api.hot.requests`, `telemetry.api.hot.latency`, `telemetry.api.hot.errors`. See monitoring documentation.

---

## 6. Acceptance Criteria

### AC1 – Query Core Fields

**Given** asset ID and authenticated request  
**When** querying hot storage API  
**Then** core fields are returned correctly

### AC2 – Meet Latency Requirements

**Given** API request is made  
**When** querying hot storage  
**Then** response latency is < 100ms

### AC3 – Handle Errors

**Given** invalid request or storage unavailable  
**When** API request is made  
**Then** appropriate error response is returned

---

## 7. Performance Requirements

- **Response Latency:** < 100ms for core fields
- **Throughput:** Handle concurrent API requests
- **Query Optimization:** Efficient hot storage queries

---

## 8. Testing Strategy

### 8.1 Unit Tests

- API endpoint logic
- Parameter validation
- Response formatting

### 8.2 Integration Tests

- End-to-end API with real data
- Hot storage integration
- Error scenarios

---

## 9. References

### 9.1 Related Documentation

- **[Epic 6 Overview](./README.md)**: Epic context
- **[API Contracts](../api-contracts/README.md)**: Detailed contract specification
- **[Epic 4 - Storage](../E4-Storage-Data-Management/F4.1-Store-to-Hot-Storage.md)**: Hot storage

---

## 10. Non-Goals

- Warm storage API (covered by F6.3)
- WebSocket streams (covered by F6.1)

---

## 11. Open Questions

1. What are the exact API endpoints?
2. What query parameters should be supported?

---

## 12. Change History

| Date | Version | Author | Changes |
|------|---------|--------|---------|
| 2025-01-XX | 1.0 | [Author] | Initial feature specification |

