# F6.3 – REST API for Warm Storage

**Epic:** E6 – API & Consumption  
**Depends on:** E4 (warm storage)  
**Related Features:** F6.2 (REST API for Hot Storage), F6.4 (API Authentication)

---

## 1. Description

Expose REST API endpoints for querying complete telemetry fields from warm storage. Provides < 500ms access to complete fields for historical and detailed use cases.

### 1.1 Purpose

Enable REST API access to complete telemetry fields. Provides access to all Fleeti telemetry fields (~343+ fields) for asset detail views, customer APIs, and historical analysis.

### 1.2 Context

Customers and frontend applications need access to complete telemetry data. Warm storage REST API provides access to all fields with < 500ms latency.

### 1.3 Value Proposition

Enables REST API access to complete telemetry fields with acceptable latency. Supports asset detail views and customer API integration.

---

## 2. Business Logic

### 2.1 Rules & Priority

**API Endpoints:**
- `GET /api/v1/telemetry/warm/assets/{assetId}` - Get current complete fields for asset
- `GET /api/v1/telemetry/warm/assets/{assetId}/history` - Get historical telemetry
- Query parameters: `fields[]`, `startTime`, `endTime`, `limit`

**Response Format:**
- Complete fields (~343+ fields)
- Include top_status and statuses[]
- Timestamp and asset metadata
- Historical data with time range

**Performance:**
- < 500ms response latency for current data
- < 2 seconds for 1-month historical query

### 2.2 States & Behaviors

**API States:**
- **Available**: API is available and responding
- **Degraded**: API is slow or partially available
- **Unavailable**: API is down

**Behaviors:**
- Query warm storage for complete fields
- Support time-range queries for historical data
- Return JSON response
- Handle errors gracefully

### 2.3 Edge Cases

- **Asset Not Found**: Return 404
- **Storage Unavailable**: Return 503
- **Invalid Time Range**: Return 400
- **Large Time Ranges**: Paginate or limit results

---

## 3. Technical Specification

### 3.1 Inputs

- **Asset ID**: Asset identifier (path parameter)
- **Query Parameters**: Fields filter, time range, limit
- **Authentication**: API token (header)

### 3.2 Processing Logic

1. Authenticate request (F6.4)
2. Validate parameters
3. Query warm storage for complete fields
4. Format response
5. Return JSON response

### 3.3 Outputs

- **JSON Response**: Complete fields data
- **HTTP Status**: 200 OK, 400 Bad Request, 404 Not Found, 503 Service Unavailable

### 3.4 Data Structures

```json
{
  "asset_id": "uuid",
  "timestamp": 1234567890123,
  "telemetry": { /* complete Fleeti telemetry */ },
  "status": { "top_status": "in_transit", "statuses": [...] }
}
```

---

## 4. Integration & Contracts

### 4.1 API Contracts

**API Contract:** [`../api-contracts/README.md`](../api-contracts/README.md)

Detailed REST API contract specification including endpoints, request/response formats, and error codes.

### 4.3 External Service Integration

**Service:** Warm Storage (Epic 4)  
**Integration Type:** Storage query API  
**Usage:** Query complete fields

---

## 5. Cross-Cutting Concerns

### 5.1 Security

**Reference:** [`../../7-security/README.md`](../../7-security/README.md)

API requests must be authenticated. See security documentation.

### 5.3 Error Handling

**Reference:** [`../../5-operations/error-handling.md`](../../5-operations/error-handling.md)

API errors must be handled gracefully. See error handling documentation.

### 5.4 Monitoring & Observability

**Reference:** [`../../5-operations/monitoring-observability.md`](../../5-operations/monitoring-observability.md)

Must emit metrics: `telemetry.api.warm.requests`, `telemetry.api.warm.latency`, `telemetry.api.warm.errors`. See monitoring documentation.

---

## 6. Acceptance Criteria

### AC1 – Query Complete Fields

**Given** asset ID and authenticated request  
**When** querying warm storage API  
**Then** complete fields are returned correctly

### AC2 – Meet Latency Requirements

**Given** API request is made  
**When** querying warm storage  
**Then** response latency is < 500ms for current data

### AC3 – Support Historical Queries

**Given** time range is provided  
**When** querying warm storage API  
**Then** historical telemetry is returned correctly

---

## 7. Performance Requirements

- **Response Latency:** < 500ms for current data, < 2 seconds for 1-month historical
- **Throughput:** Handle concurrent API requests
- **Query Optimization:** Efficient warm storage queries

---

## 8. Testing Strategy

### 8.1 Unit Tests

- API endpoint logic
- Parameter validation
- Response formatting
- Historical query logic

### 8.2 Integration Tests

- End-to-end API with real data
- Warm storage integration
- Historical query scenarios
- Error scenarios

---

## 9. References

### 9.1 Related Documentation

- **[Epic 6 Overview](./README.md)**: Epic context
- **[API Contracts](../api-contracts/README.md)**: Detailed contract specification
- **[Epic 4 - Storage](../E4-Storage-Data-Management/F4.2-Store-to-Warm-Storage.md)**: Warm storage

---

## 10. Non-Goals

- Hot storage API (covered by F6.2)
- WebSocket streams (covered by F6.1)

---

## 11. Open Questions

1. What are the exact API endpoints?
2. What query parameters should be supported?
3. How should pagination work for historical queries?

---

## 12. Change History

| Date | Version | Author | Changes |
|------|---------|--------|---------|
| 2025-01-XX | 1.0 | [Author] | Initial feature specification |

